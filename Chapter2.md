# 仮想化環境およびクラウドについて
本教科書では、Linuxをインストールし、サーバー環境を構築する実習をしながら、LinuCレベル2の範囲の理解と取得を目指します。第1章では、Linuxサーバーの概要について解説し、2章以降に行う実習に必要な環境と知識の確認を行います。

# 用語集
## 仮想化技術
ハードウェアの機能をソフトウェアで実現する技術。仮想マシンや仮想ネットワーク、仮想ストレージなど様々な種類の技術が存在しています。

## 仮想マシン
仮想化技術を利用して、コンピューターのハードウェアをソフトウェアで実現したもの。OSをインストールし、様々なアプリケーションを実行できます。

## 仮想ホスト
仮想マシンを実行するマシンのこと。仮想ホストでは通常のOSが動作しており、仮想マシンは通常のアプリケーションのように動作します。

## コンテナ
仮想化技術の一種。仮想マシンがハードウェアからOS、アプリケーションまですべてをソフトウェアで実行するのに対して、コンテナはアプリケーションだけを仮想化して実行します。そのため、OS

# 仮想化環境とは
仮想化環境とは、仮想化技術を活用して構築、動作させるシステムの環境のことです。仮想化技術には、仮想マシン、仮想ネットワーク、仮想ストレージ、コンテナなどがあります。

## 仮想化技術とクラウドの関係
現在では、クラウドを活用してシステムを構築、運用することが増えています。多くのクラウドサービスが仮想化技術を活用する事で、効率良くシステムリソースをユーザーに対して提供することでそのサービスを実現しています。クラウドを理解し、活用するためにも、仮想化技術の基礎を理解しておく必要があります。

# 仮想マシンとは
仮想マシンは、ソフトウェアで仮想的なマシンを実行する仕組みです。仮想マシンにはOSをインストールし、アプリケーションを実行できるので、

## ホストOS型とハイパーバイザー型
仮想マシンの実行環境には、ホストOS上でアプリケーションのように実行される「ホストOS型」と、仮想マシン実行専用のソフトウェアであるハイパーバイザーが動作する「ハイパーバイザー型」に大別されます。

本教科書では、簡単に実行できるホストOS型を取り上げています。

# 仮想マシンのメリット

## ホストOSと共存できる
仮想マシンはホストOS上でアプリケーションのように実行されます。そして同時にその他のアプリケーションも実行できるので、たとえばWebブラウザで何かを調べながら、ターミナルで仮想マシン上のLinuxにログインして操作する、ということが簡単に行えます。

## ハードウェアを用意する必要がない
Linuxを使ったサーバー構築を学習する際に大きな障害となるのが学習用ハードウェア環境の準備です。ハードウェアを用意できたとしても、Linuxをインストールするには設定を変更するなどのハードウェアの知識が要求されます。メーカーの違いによって設定方法も異なるため、学習の助けを得るのも難しくなります。

仮想マシンではそのような前提知識が要求されることが少ないので、容易にLinuxをインストールして学習環境を構築できます。

## 柔軟性
仮想マシンは必要に応じて簡単にCPU数やメモリ容量、ディスク容量などを変更できる柔軟性を備えています。

## OS選択
仮想マシンにはそれぞれ別々のOSをインストールできます。たとえばLinuxとWindowsがそれぞれインストールされた仮想マシンを同時並行で実行できます。

# 仮想マシンのデメリット

## 速度
仮想マシンは、コンピューターの動作をソフトウェアで実現しているので、ハードウェアそのものでOSやアプリケーションを動作させるよりも動作が遅くなります。

## リソースの消費
仮想マシンを複数同時に実行することができますが、その分だけCPUやメモリ、ストレージなどのリソースを消費します。ホストOSを快適に動かすのにもリソースが必要となるため、使用するハードウェアにはより多くのリソースを用意する必要があります。

# 仮想マシンのリソース
仮想マシンを作成する際に、CPUやメモリ、ネットワークインターフェース

## CPU
仮想マシンには必要なだけの数のCPUを割り当てられます。ただし、CPUをホストOSやその他の仮想マシンとの間で取り合うことになるため、沢山割り当てればよいというわけではありません。

## メモリ
仮想マシンに設定したメモリ容量は、その分だけホストマシンから仮想マシンに対して割り当てられます。ホストマシンにはホストOSだけでなく、仮想マシンに割り当てられるだけの容量のメモリを搭載しておく必要があります。

## ストレージ
仮想マシンには、ハードディスクやSSDのようなディスクと、CD/DVDのような光学ディスクを割り当てることができます。

### 仮想ディスクファイル
HDDやSSDは、仮想ディスクファイルという形でホストOS上に作成されます。可変式ファイルの場合には、仮想マシンが使用した分だけのサイズのファイルになります。固定式ファイルの場合には、作成時に設定しただけの容量のファイルが作成されます。可変式にすることで、ホストマシンのディスク使用を節約できます。

### 仮想光学ドライブ
仮想マシンに割り当てられた仮想光学ドライブは、物理的な光学ドライブにセットされたCD/DVDメディアを割り当てる他、ISOイメージを割り当てることができます。仮想マシンにOSをインストールするのが容易な理由の一つです。

## ネットワーク
仮想マシンに割り当てられるネットワークインターフェースを割り当てることができます。仮想マシンソフトウェアによって機能が異なるため、それぞれの機能に応じた利用が必要になります。

# コンテナ
コンテナも仮想化技術の一種ですが、仮想マシンと異なりOSのカーネルはホストのものをそのまま利用します。アプリケーションのプロセスだけを仮想化して、見かけ上別々のシステムが動作しているようにする仮想化技術です。

## コンテナイメージ
コンテナイメージは、コンテナが利用するファイルシステムを1つのファイルにまとめたものです。仮想マシンでいえば仮想ディスクファイルに相当します。各種Linuxディストリビューションによって作成されたコンテナイメージが提供されているので、別々のディストリビューションのコンテナを同時並行して実行することもできます。

## Docker
Dockerは、コンテナの実行環境の一つです。コンテナの実行はもちろん、コンテナが利用するコンテナイメージを生成するDockerfileや、各種管理ツールなどが提供されています。「Docker Desktop」というパッケージが各種OS用に提供されており、簡単にDockerを実行することができます。

# クラウド

## IaaS
IaaSは、ITインフラストラクチャ（サーバー、ネットワーク、ストレージなど）を仮想化し、クラウドプロバイダーからレンタルするサービスです。ユーザーは物理的なハードウェアの管理をせず、必要なリソースを必要なときに利用できます。これはスケーラビリティと柔軟性が高く、新しいサーバーの設定から運用までを簡略化します。

## PaaS
PaaSは、ソフトウェア開発のプラットフォームを提供するサービスです。開発者はアプリケーションコードを書きデプロイするだけで、プラットフォームがインフラストラクチャなどの管理を担当します。これによりアプリケーションの開発と展開が簡略化され、効率的に行えます。

### DBaaS
DBaaSは、データベースの管理と運用をクラウドプロバイダーに委託するサービスです。ユーザーはデータベースの設定と管理から解放され、スケーラビリティ・バックアップ・セキュリティなどの重要な側面をクラウドプロバイダーが提供します。これによりデータベースの運用が簡便になります。

## SaaS
SaaSは、クラウド経由でソフトウェアを提供するモデルです。ユーザーはアプリケーションを購読しブラウザを通じて利用します。ソフトウェアのインストールやメンテナンスは不要で、定期的なアップデートもクラウドプロバイダーが行います。

## FaaS
FaaSは、アプリケーションの個々の機能（関数）を独立して実行するサービスです。開発者は必要な機能を関数として記述し、クラウドプロバイダーがトリガーに応じて自動的に実行します。これはスケーリングが容易でコストを最適化できるため、マイクロサービスアーキテクチャに適しています。

## CaaS
CaaSは、コンテナ技術（Dockerなど）を利用してアプリケーションをパッケージ化し、クラウド上で実行するサービスです。コンテナは独立して実行され環境に依存しないため、開発とデプロイが簡素化されアプリケーションの移植性が向上します。

# インストール用ISOイメージの準備
OSのインストールには、ISOイメージのダウンロードが必要です。

2章の解説を参考にしてダウンロードしたISOイメージのファイルを用意しておきます。

# VirtualBoxのインストール
本教科書の実習では、仮想マシンソフトウェアである「VirtualBox」上にLinuxを導入して、その環境上に様々なサーバーを導入し実際に動作させます。

## 使用するコンピューターの仮想化支援技術の有効化
VirtualBoxを実行するには、使用するコンピューターが搭載しているプロセッサの仮想化支援技術が有効になっている必要があります。仮想化支援技術は、IntelのCPUではIntel VT、AMDのCPUではAMD-Vと呼ばれます。

仮想化支援技術を有効にするには、コンピューターのUEFI設定画面で設定を行います。設定方法の詳細は、使用するコンピューターの説明書などを確認してください。

## VirtualBoxのダウンロード
VirutalBoxは、次のURLからダウンロードできます。

https://www.virtualbox.org/

ホストOSの種類に合わせてダウンロードを行えます。今回はWindows環境にインストールします。

左のメニューからDownloadsをクリックし、VirtualBox binariesからWindows hostsをクリックして、インストーラーをダウンロードします。

## Virtualboxのインストール
VirtualBoxのインストーラーをダウンロードしたら、インストーラーを起動してインストールします。

インストール時の特別な設定は行いませんので、インストーラーの指示に従ってインストールします。

インストーラーが仮想ネットワークのインストールについて、またPythonとの連携について確認を取ってきますが、そのまま進めても問題ありません。

インストール終了後、Finishボタンをクリックするとインストーラーが終了し、VirtualBoxが起動します。

# VirtualBoxの起動
VirtualBoxを起動します。

インストーラーが自動で起動した状態ではない場合には、デスクトップ上に追加されたVirtualBoxをダブルクリックして起動します。

VirtualBoxが起動すると、VirtualBoxマネージャーが表示されます

## VirtualBoxマネージャー
VirtualBoxマネージャーは、VirtualBoxによる仮想マシン実行環境全体を管理するツールです。主に以下のことが行えます。

・VirtualBox自身の各種設定
・仮想マシンの管理
・メディア（ISOイメージ等）の管理
・仮想ネットワークの管理

# 仮想マシンの作成
仮想マシンを作成します。

VirtualBoxマネージャーで新規(N)をクリックし、新しい仮想マシンの作成を開始します。各種設定を対話形式で設定していくガイド付きモードと、1つの画面で設定できるエキスパートモードが選択できます。ここではデフォルトのガイド付きモードで作成します。


## 仮想マシンの名前とOSの設定
まず最初に、仮想マシンの名前とOSの種類などを設定します。これらの設定は後から変更することもできるので、その他の項目で必要なものは後ほど設定を行います。

設定する項目と、設定する内容は以下の通りです。

名前：ServerA
タイプ：Linux
バージョン：Red Hat (64-bit)

設定しましたら、次へをクリックします。


## 仮想マシンのハードウェアの設定
仮想マシンのハードウェアの設定として、メインメモリーの容量とプロセッサの数を設定します。また、EFIの設定も行います。

メインメモリー：2048MB
Processors：1
Enable EFI(special OSes only)：チェックする

メインメモリーの容量は、使用しているコンピューターが搭載しているメモリ容量以下に制限されます。仮想マシンにある程度多めのメインメモリーを割り当てることで快適に動作させることができます。設定はデフォルトの2048MBでも動作しますが、余裕があれば4096MBから8192MB（4GBから8GB）ほど割り当ててもよいでしょう。

プロセッサの数は、使用しているコンピューターが搭載しているプロセッサのコア数以下に制限されます。また、プロセッサによっては仮想CPU機能により見かけ上コア数が2倍になっている場合もあります。設定はデフォルトの1つでも動作しますが、余裕があれば2から4ほど割り当ててもよいでしょう。

Enable EFIは、デフォルトではチェックされていません。OSのインストール画面のサイズが合わず一部の画面が見えなくなる問題が発生するため、チェックしておきます。

設定しましたら、次へをクリックします。

## 仮想ハードディスクの設定
OSのインストール先となる仮想ハードディスクの設定をします。

Disk Size：20.00GB

仮想ハードディスクの容量は、使用しているコンピューターが搭載しているストレージの容量以下に制限されます。また、Pre-allocate Full Sizeのチェックをしない限り、仮想ハードディスクの容量はゲストOSが使用した分だけしか消費しませんので、設定は最大消費容量を指定することになります。

OSのインストールとサーバーの設定だけではそれほど沢山の容量を必要としませんが、実際に運用するサーバーを作る場合には必要な容量を見積もって設定する必要があります。また、後から仮想ハードディスクを追加することもできるので、追加方法について学習してもよいでしょう。

設定しましたら、次へをクリックします。

## 仮想マシンの設定を確認
最後に仮想マシンの設定を確認します。ここまでの手順で設定した内容が反映されているかどうか、あらためて確認します。確認後、完了をクリックします。

VirtualBoxマネージャーに、新しく作成した仮想マシンが追加されたことを確認します。

# 仮想マシンの設定変更
仮想マシンの設定を追加で変更します。

VirtualBoxマネージャーで仮想マシンを選択し、右側に表示される各種設定情報から変更が行えます。設定項目の見出し部分（「一般」や「システム」など」をクリックすると、その項目の設定画面が表示されます。

## EFIの有効化を確認
仮想マシン作成時にEFIの有効化を行っていないと、OSのインストーラーを起動した際に画面のサイズが合わず一部の画面が見えなくなる問題が発生します。

「システム」をクリックし、以下の設定にチェックが入っていることを確認します。チェックが入っていない場合にはチェックします。

EFIを有効化(一部のOSのみ)(E)：チェックする

確認、あるいは修正ができたら、OKをクリックします。

# ネットワークの追加
ネットワークを追加します。

デフォルトではNATを使った外部ネットワークに接続するネットワークのみ設定されています。ホストマシンと仮想マシンが通信できるようにするため、ホストオンリーアダプターを追加します。

## 仮想ネットワークの設定を確認
VirtualBoxの仮想ネットワークの設定を確認します。

VirtualBoxマネージャーの「ツール」右側のリストボタン（横3本線）をクリックし、「ネットワーク」を選択します。「Host-only Networks」タブを選択し、「VirtualBox Host-Only Eternet Adapter」が存在していることを確認します。IPアドレスは、インストール時に自動的に作成された場合には192.168.56.1/24が設定されています。このIPアドレスは別の値に変更したり、追加した場合には第3オクテットが異なるIPアドレスがランダムで割り当てられます。

DHCPサーバーもデフォルトで有効になっていますが、本教科書の演習ではDHCPサーバーは使用しません。

## 仮想マシンにネットワークアダプターを追加
仮想マシンにネットワークアダプターを追加します。

VirtualBoxマネージャーから仮想マシンを選択し、右側の各種設定情報から「ネットワーク」を選択します。

仮想マシンには最大4つのネットワークアダプターを設定できます。アダプター1はNATが設定されているので、このままにしておけば外部のネットワークやその先にあるインターネットに接続できます。

アダプター2のタブを選択し、「ネットワークアダプターを有効化」をチェックします。「割り当て」を「ホストオンリーアダプター」に設定すると、「名前」に「VirtualBox Host-Only Ethernet Adapter」が設定されます。

設定したら、OKをクリックします。

# ISOイメージを仮想光学ドライブで読み込む設定
あらかじめ用意しておいたOSインストール用のISOイメージを、仮想マシンの仮想光学ドライブで読み込む設定をします。

VirtualBoxマネージャーから仮想マシンを選択し、右側の各種設定情報から「ストレージ」を選択します。

仮想マシンには、IDEとSATAの2種類のストレージデバイスが接続されています。仮想光学ドライブはIDEに接続されています。読み込む設定が何もされていない場合、「空」と表示されているのが仮想光学ドライブですので、選択します。

「光学ドライブ:IDE セカンダリマスター」の右にある円形のボタンをクリックし、「ディスクファイルを選択」を選択すると、ファイルダイアログが開きます。準備しておいたOSインストール用のISOイメージを選択し、「開く」をクリックします。「空」の表示がファイル名に変わります。

以上で仮想マシンの作成と、OSインストールの準備は完了です。
